
feel p2  Finite Element Equation Language Prototype Version 2

   1995/04/11  １次元版の作成に伴う作業の本格的な再開

parseプログラムのtree図


main()  YaccMain.c に存在する
 |
 |-  init(); 
 |     |-----  cell_init() 数式の構文解析の為のセルの初期化
 |     |-----  var_init()  変数宣言の構文解析の為初期化
 |
 |-yyparse()  構文解析プログラム
   | |
   | |-  各構文解析プログラム(構造体に情報を格納する)
   |
   |-debug_start() デバッグ処理開始(現在デバッグ中)
   |
   |-feel_exec_main() feel fort77作成プログラム本体
      |
      | この時点でエラーがあれば処理を打ち切る。
      |
      |-InitMakeDeletefile() 一時ファイル記録用領域の初期化
      |
      |-get_user_info() ユーザに関する情報の取得
      |
      |
      |-pre_to_inf_init()  【重要】前置記法を中間置記法に変える為の準備
      |                            各expressionのチェックにて、
      |                            pre_to_inf_push()を行い、
      |                            make_fort77に入る直前に
      |                            do_pre_to_inf()を実行する。
      |
      |                            このpre_to_infは、特別な処理を必要
      |                            としない物に対して(write文など)
      |
      |
      |-feel_data_check()   dataのチェックプログラム
      |   |                 ここでは、dataのチェックと付随するデータ作成
      |   |                 を行う。
      |   |
      |   |-region_subdomain_check()
      |   |-region_domain_check()
      |   |
      |   |-mesh_error_check()
      |   |    ○多重定義(yaccの時点でしているものもあり)
      |   |
      |   |
      |   |-var_error_check()    
      |   |    ○FEM変数処理(対応する構造体アドレスの割り出し)
      |   |    ○EWISE変数処理(対応する構造体アドレスの割り出し)
      |   |
      |   |-element_error_check()
      |   |
      |   |-quadrature_error_check()
      |   |
      |   |-scheme_error_check()
      |   |
      |   |-solve_check_main()
      |   |  |
      |   |  |-solve_chk_var()  /* 変数に関するcheck */
      |   |  |   SolveElement構造体に既知変数、未知変数リストの作成
      |   |  |   SolveElementに対するdomain名の確定
      |   |  |   
      |   |  |-solve_chk_bd_bar()
      |   |  |   Solve構造体への代入(mainより送る変数表の作成、特に境界項)
      |   |  |
      |   |  |-solve_chk_quadrature()
      |   |  |   o指定されている数値積分法が定義されているかどうか検査する
      |   |  |- 各SolveElementに対して要素番号付加☆
      |   |  |- 各SolveElementの節点データ計算☆
      |   |  |
      |   |  |-solve_chk_domain_vs_var() 
      |   |  |  ○各solve_elementの要素形状とfem,ewise変数との整合性チェックと
      |   |  |  ○solve_element_ptr->etypeの代入
      |   |  |
      |   |
      |
      | 【LET文の処理】  (未定義)
      |     必要ならedatデータの作成            ← 93/12 - 94/1での難問
      | 
      |
      | ★エラーが無ければ以下の処理を続行する
      |
      |-solve_dat_make_main()
      |   | ○各solveに対して、SolveFORT77,ElemFORT77構造体の作成
      |   |   まず、使用変数を書き出す
      |   |
      |   ||solve文の数でループ
      |   ||
      |   ||SolveFORT77構造体の作成、構造体はsolve_ptr->solve77_ptrに格納
      |   ||            → make_solve_ctrl77()ルーチン作成時に使用
      |   ||○各solve文の番号付け
      |   ||○SolveFORT77構造体に引き数の変数リストを作成
      |   || 
      |   ||  ElementFORT77構造体へのポインタ記憶領域のsolve77_ptrへの割り付け
      |   ||    ☆割り付け先が SolveFORT77構造体に注意 ^^^^^^^^^^^
      |   ||                
      |   ||| 各SolveElementに対するループ
      |   |||
      |   |||-elem_dat_make_main()
      |   |||  |
      |   |||  | ○メッシュパターンの作成＝要素節点集合データ種の割り出し
      |   |||  |- element_node.cの関数群により、ElemDat構造体を作成
      |   |||  |  store_element_node_init_()
      |   |||  |  store_element_node() 
      |   |||  |  make_element_node_dat()
      |   |||  |  
      |   |||  |- store_edat()  ElemDatの取得(この関数はedat_noを返す)
      |   |||  |  
      |   |||
      | 
      | 
      |- make_fem_varinfo()     各edatに対応するデータの作成
      | 
      |- set_boundary_no()      Dirichlet境界条件の境界番号を決定
      | 
      | 
      | 【中間置記法】
      |-do_pre_to_inf()  中間置記法数式の作成
      | 
      | メッシュ生成データの作成
      | (solve_comp内の関数)
      |-make_mesh_ctrl_data() メッシュデータに関する制御データを作成
      |  |
      |  |
      |  | ○領域番号、境界番号の作成、およびデータの正規化
      |  | ○各要素単位で中間節点データ等の作成
      |  | ○境界条件付加の為のデータ作成
      |  |
      |  | domainは現在のメッシュ生成プログラムでは１つ
      |  |
      |  |  各solve文におけるdomain内の節点パターンは同一
      |  |  make_mesh_ctrl_dataの処理は、domain文の節点パターンの
      |  |  orを取り、必要な節点を全て生成し、各domain毎に実際の
      |  |  データ番号を割り振るべし。
      |  |
      |  | ただし、その内部の節点パターンは色々あっても構わない
      |  |
      |  |☆☆☆ここで、domainに対するElemDat構造体を作成する
      |  |
      |  ||SolveElementの分だけループする
      |  ||   □各SolveElementのElemDat構造体の節点の和集合をとる
      |  ||
      |  ||-store_element_node_for_mesh()
      |  ||
      |  |
      |  |
      |  ||次元による分岐
      |  ||
      |  ||-mesh_exec_1D(mesh_elem_dat_ptr)(一次元メッシュ生成ルーチン)
      |  ||     | (主に、各部分領域ごとに割り付けるべき節点数を決定する)
      |  ||     |RegionSegment構造体に必要な情報を入れる
      |  ||
      |  ||
      |  ||-mesh_book_exec(2次元メッシュ生成)
      |  |      | (mesh_bookルーチン群の呼出などを行う)
      |  |      | MESH.GEOデータファイルの作成
      |  |      |-mid_info_for_meshbook() 中間節点情報の作成
      |  |      | MESH.PRM(中間節点情報ファイルの作成)
      |  |      |-make_MESH_REF()     MESH.REFファイルの作成
      |  |      |
      |  |      |-- メッシュ生成コマンドの実行
      |  |      |- get_mesh_data()    宣言点における節点番号の取得
      |  |
      |
      |
      ||case 次元による分岐
      ||
      ||- make_feel_data_file_1D() 1次元用'feel_dat'ファイルの作成
      || |
      || | feel_datの制御部を書く
      || |
      || |
      || |
      || |
      ||
      ||
      ||- make_feel_data_file()  'feel_dat'ファイルの作成
      || |
      || | feel_datの制御部を書く
      || |  1-1  ndim          = 2  直接
      || |  1-2  npmax         ファイル仮読み
      || |  1-3  nedat         ファイル仮読み
      || |  1-4  nodeset       = current_nodesetno();
      || |  1-5  numset        = 0  直接
      || |
      || |  2-1  mode_ex       実行モード  = 0 直接
      || |  2-2  mode_output   実行        = 0 直接
      || |
      || |  3-1  nvars_fem     fem変数の数   = how_many_fem_vars()
      || |  3-2  nvars_ewise   ewise変数の数 = how_many_ewise_vars()
      || |  
      || |  ewise変数があれば、
      || |  ewiseが定義されている代表domainのedat番号と要素内点数を書く
      || |       ※ここで、代表edat番号はewise構造体から引っ張るのでは
      || |         なく、ewiseの定義domain名からget_domain_edatno_by_name()
      || |         で求めて代入している
      || |  
      || || edatデータ、節点データをファイルに書く
      || ||
      || ||-make_feel_data_edat()
      || ||-make_feel_data_point()
      || |  
      || |- make_boundary_data_for_bc_main()  境界に関するデータの作成
      || |  | ※注意  domainが一つであることを仮定
      || |  |
      || |  |-get_nth_domain_elem_dat_ptr(0) 
      || |  | 全基底関数に関する節点のORであるmesh_edatデータへの構造体を得る
      || |  |
      || |  |-mid_info_for_meshbook()
      || |  | mesh_midpoint構造体に中間節点情報を格納
      || |  |
      || |  ||solve文に関するループ
      || |  ||現在、solve文には一つのSolveElementしかないから、
      || |  ||SolveElementに関するループと同じ意味
      || |  ||
      || |  ||各SolveElementのElemDat構造体に対して中間節点情報を得る
      || |  ||
      || |  ||Dirichlet条件処理の為にvarinfo構造体を得る
      || |  || (連立問題においての累積節点自由度から方程式番号への増分を求める)
      || |  ||
      || |  ||各Dirichlet条件に対して、使用するフラグ配列を作成
      || |  || elem_edge_use_flag[] 境界各節点に自由度があるかないか
      || |  || elem_edge_use_plus[] 累積節点自由度→方程式番号への増分
      || |  ||
      || |  || 節点パターンの作成
      || |  || 境界点の重なりを意識して、
      || |  ||  push_boundary_nset_point();
      || |  ||  push_boundary_nset_line();
      || |  || にデータを退避
      || |  ||
      || |  ||-make_boundary_nset() ここで実際に書き出す
      || |  |
      || |  |ノイマン条件についてのデータ作成
      || |  ||solve文に関するループ
      || |  ||
      || |  ||-make_boundary_edat_reset()
      || |  ||-make_boundary_edat()
      || |  ||
      || |  ||
      || | 
      || |- make_boundary_plot_data_main() プロットデータのための境界点出力
      || |
      || |
      |
      |
      | メッシュ生成のみの場合は以下の処理のほとんどを行わない
      |
      |-InitMakeMakefile() Makefileを作成する為の準備
      |
      |-make_feel_fort77() メインプログラム等、基本ルーチンの作成
      |  |
      |  |-InitMakeMakefile() Makefileを作る際の初期化
      |  |
      |  |-data_initialize()
      |  |
      |  |-system_default()
      |  |
      |  |:-  make_main()        メインルーチン作成
      |  |:-  para_make_main()   並列版メインルーチン作成
      |  |       |     【注意】  スカラー版と共通に呼び出す関数あり
      |  |       |               para_make_mainでは基本的に並列処理の
      |  |       |               ために新規ブロックを記述するために作成。
      |  |       |-para_block_data()
      |  |
      |  |
      |  |
      |  |-fort77lib_make()   ライブラリのソース展開(必要に応じて)
      |  |
      |  |-make_solve_fort77()  solveブロックに対応するルーチンの作成
      |  |  |
      |  |  |
      |  |  || ［各solve文に関するループ］
      |  |  ||-make_solve_ctrl77() solve文の最初のfortranコード生成
      |  |  ||                     solve??.fの作成
      |  |  ||   引き数の規約等は'   .doc'を参照のこと
      |  |  ||
      |  |  ||
      |  |  ||| 【各SolveElementに対するループ】
      |  |  |||-elem_fort77_main() 各要素構成プログラム作成
      |  |  |||
      |  |  |||
      |  |  ||
      |  |  ||
      |  |  |
      |
      |
      |
      |- JustifyFORTfile()      FORTRAN 72カラム設定の為
      |
      |- MakeMakefile()         Makeファイルを作成
      |
      |- DoDeletefile() !status_no_deleteフラグによってファイルを消去
      | おしまい。








