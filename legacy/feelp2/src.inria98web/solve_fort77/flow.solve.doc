feel p2

     solve文処理の流れ
-----------------------------------------------------------------------------
連立問題での変数位置定義方法

局所節点ー未知変数情報(Hermite要素で無い場合)

節点１  
節点２  
節点３

節点累積自由度配列の作成IPD(NP) 
自由度が設定されない自由度は０を設定

------------------------------------------------------------------------
--coding sketch--
 |
 |--solve0?
 |  |
 |  |★【ステップ１】連立一次方程式の係数行列格納topologyの計算
 |  |    ●計算済みフラグが立っていればファイルから読み込み
 |  |
 |  |    ○配列割り当て
 |  |    ○節点毎自由度の計算
 |  |    ○累積節点自由度の計算
 |  |    ○バンド幅などの計算
 |  |    ○行列格納に必要な情報配列の作成
 |  |
 |  |
 |  |  【ステップ２】非線形問題の場合の初期値代入処理
 |  |
 |  |    ○配列割り当て
 |  |    ○
 |  |
 |  |
 |  |  【ステップ３】各要素毎の係数行列の計算
 |  |    ○配列割り当て
 |  |    ○各要素プログラム呼び出し
 |  |
 |  |  【ステップ４】ノイマン境界条件処理
 |  |
 |  |
 |  |  【ステップ５】ディリクレ境界条件処理
 |  |
 |  |
 |  |  【ステップ６】連立一次方程式ルーチン呼び出し
 |  |
 |  |
 |  |  【ステップ７】非線形問題の場合の繰り返し判定処理
 |  |
 |  |

各要素内小行列計算の実行

【数値積分版】
 |  |
 |  |-elem??_??(x,y,fem変数,ewise変数,
 |  |   |
 |  |   | 計算に必要な配列の宣言
 |  |   | 
 |  |   | 積分点毎の    関数値, 関数の微分値(r,s,t)
 |  |   |   ■LISPプログラム
 |  |   |      dimension gx1(n),gy1(n),gz1(n),w(n)の形
 |  |   |      基底関数 積分点   要素名_1(n)
 |  |   |                        要素名_x1(n)   x微分
 |  |   |                        要素名_y1(n)   y微分  など
 |  |   |
 |  |   |
 |  |   | 【ステップ１−１】作業配列等の計算
 |  |   |
 |  |   | ○計算に必要な配列設定プログラム呼び出し
 |  |   |
 |  |   |- 積分点毎の関数値、関数微分値の計算プログラム
 |  |   |
 |  |   | 【ステップ１−２】データ読みだし
 |  |   |
 |  |   | ○要素節点番号対応配列の読みだし
 |  |   | ○要素指向節点座標配列の読みだし(現バージョンでは割愛か？)
 |  |   | 
 |  |   |
 |  |   |
 |  |   |★要素数に関してループ
 |  |   | 
 |  |   |- 要素内小行列作成プログラム呼び出し  
 |  |   | 
 |  |   | call celem??_??(ea,eb,
 |  |   |   ■LISPプログラム
 |  |   |
 |  |   |
 |  |   |

------------------------------------------------------------------------

==============
【ステップ１】
==============
局所節点自由度を表す配列を作成する

  IPD(*) 配列の取得

  IPD(*)  を０クリアする。(全節点に対して)
  IWISE(*)を０クリアする。   ※ewise自由度がある場合、

  IEF(1)  = 3   局所節点自由度
  IEF(2)  = 3   
    .....
  IEF(15) = 2


  まず、IPDには各節点毎の自由度を求めて格納する


  do 100 i=1,要素数
   do 110 j=1,要素内節点自由度
   IPD(IELEM(i,j)) = IEF(j)
   continue                         ことを仮定する
  continue

 ※system ewise変数がある場合、各要素の最終局所節点後に自由度を加える
  do 120 i=1,要素数
   IPD(IELEM(i,15  ※要素内節点数)) += 要素内節点無し自由度数
   IWISE(IELEM(I,NEP))=IWISE(IELEM(I,NEP))+1
   /* 配列IWISEは、節点less自由度を付加する節点に、複数の要素からの
      付加があったかどうかを判定する */
  continue

  節点毎自由度が求まる(節点less自由度がある場合に注意が必要)

  累積自由度を生成する(節点less自由度がある場合には各要素ごとの
                       開始方程式番号を求める)

  do 200 i=1,numnp                //方程式の開始節点番号を探す
   if( ipd(i) .ne. 0 ) then
     istart = i
     goto 300
   endif
  continue;

250 error stop----(no unknown term)

300 continue
    nowfree = ipd(istart)
    ipd(istart) = 1

    do 400 i=istart+1,numnp

    if(ipd(i) .eq. 0) goto 400

      itmp = ipd(i)
      ipd(i) = nowfree + 1
      nowfree = nowfree + itmp

    endif

400 continue

    節点less自由度の方程式番号の計算
    do 500 i=1,nume
      ip = ielem(i,NEP)  /* 自由度を付加する節点番号 */
      ied(i) = iwise(ip)*ief(NEP)+ipd(ip)
      iwise(ip) = iwise(ip) - 1   /* iwise(*) は負には絶対ならないはずだが…*/
500 continue

----------------------------------------------------------------------------
連立一次方程式求解後のfem変数への分離

手法として

 要素毎に扱う   計算量が多い
 節点毎に扱う   節点の種類を記憶しておく配列が必要

今回は、要素毎に扱う方法を採用する。

    do 600 i=1,nume
      ip1 = ielem(1,i)
      ip2 = ielem(2,i)
         ......
      ip15 = ielem(15,i)
    
      ipd1 = ipd(ip1)
      ipd2 = ipd(ip2)
         ......
      ipd15 = ipd(ip15)
     
      u_fem(ip1) = b(ipd1)         /* 節点自由度(fem変数) */
      v_fem(ip1) = b(ipd1+1)
      u_fem(ip2) = b(ipd2)
      v_fem(ip2) = b(ipd2+1)
          ......
      p_fem(ip15) = b(ipd15)

      h1_ewise(i) = b(ied(i))      /* 要素内自由度(ewise変数) */
      h2_ewise(i) = b(ied(i)+1)
600 continue
-----------------------------------------------------------------------------
-----------------------------------------------------------------------------
数値積分版

形状変換関数(陽に指定されない場合は、(双)一次のものを用いる
数値積分法
-----------------------------------------------------------------------------
情報
